import {
  ApolloClient,
  ApolloLink,
  from,
  HttpLink,
  InMemoryCache,
} from "@apollo/client";
import { onError } from "@apollo/client/link/error";

const httpLink = new HttpLink({
  uri: "https://manager.preprod.thefork.com/api/graphql",
});

const errorLink = onError(({ graphQLErrors, networkError }) => {
  if (graphQLErrors)
    graphQLErrors.forEach(({ message, locations, path }) =>
      console.log(
        `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`
      )
    );

  if (networkError) console.log(`[Network error]: ${networkError}`);
});

const authLink = new ApolloLink((operation, forward) => {
  const authorization =
    "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJoYXNoU2Vzc2lvbiI6IjJhNTVkNTc2MTkzZTE4NzFmYWRiZjhkYjc1ZTEzZWVkMWFhMjM2OTUiLCJpZCI6LTEsInVzZXJuYW1lIjoiYWRyaWVuX2xvdWlzX3Jvc3NpZ25vbCIsImZpcnN0bmFtZSI6IkFkcmllbiIsImxhc3RuYW1lIjoiTG91aXMtUm9zc2lnbm9sIiwic3VwZXJBZG1pblV1aWQiOiIzMDFkMzZhMS05YzU5LTQ1YjEtYjcwMC00MjI2ZDc2Y2RmNzQiLCJ1c2VyIjp7InR5cGUiOiJlbXBsb3llZSIsImlkIjoiYWRyaWVuX2xvdWlzX3Jvc3NpZ25vbCJ9LCJyZXN0YXVyYW50cyI6W3sibGVnYWN5SWQiOjM0ODA3NSwicmVzdGF1cmFudFV1aWQiOiI5N2NmNWFlZS1lZjQ4LTQ3ODctOTY2MS0zMDU2MmZkNTkzZDEiLCJncm91cFV1aWQiOiJmMDVhM2I3Yi1lZGRhLTQwZWYtYWE1Zi0xODk0NTBhNzY1NmUifV0sImNhcGFiaWxpdGllcyI6WyJ0b2dnbGVfc2VhdGluZ190aW1lIiwic3BlY2lhbF9vZmZlcl9kYXlfYnlfZGF5X21hbmFnZW1lbnQiLCJ3YWl0aW5nX2xpc3QiLCJ0b2dnbGVfd2FpdGluZ19saXN0IiwidG9nZ2xlX2JwbSIsInRvZ2dsZV9jaG9vc2Vfc2VhdGluZyIsInNlcnZpY2VfcGFjaW5nIiwidG9nZ2xlX3Byb21vdGlvbl9tYW5hZ2VtZW50IiwicXVldWUiLCJ0b2dnbGVfcXVldWUiLCJwcm9tb3RlciIsInNlYXJjaF9yZXN1bHRzX2V4cG9ydCIsImN1c3RvbV9maWVsZHMiLCJjdXN0b21fZmllbGRzX21hbmFnZW1lbnQiLCJjdXN0b21fcmVzZXJ2YXRpb25fbGlzdCIsImN1c3RvbV9yZXNlcnZhdGlvbl9saXN0X21hbmFnZW1lbnQiLCJ1c2VfZXh0cmFfZGlzY291bnRfcGVyY2VudGFnZSIsInJlc3RhdXJhbnRfY29tbXVuaWNhdGlvbnMiLCJpbXByaW50X21hbmFnZW1lbnQiLCJ0b2dnbGVfcmVjb25maXJtYXRpb24iLCJmbG9vcl9wbGFuIiwid2hpdGVfd2lkZ2V0IiwicmVjb25maXJtYXRpb24iLCJvZmZlcl9zcGVjaWFsX2NvbW1pc3Npb25fbWFuYWdlbWVudCIsInNwZWNpYWxfY29udGFjdF9zZWdtZW50c191cGRhdGVfbWFuYWdlbWVudCIsIm9mZmxpbmVfY3Jvc3Nfc2VsbGluZyIsImNybV9tYW5hZ2VtZW50IiwiZmxvb3JfcGxhbl9tYW5hZ2VtZW50IiwiZW1haWxfY3VzdG9taXphdGlvbiIsImN1c3RvbWVyX21hbmFnZW1lbnQiLCJzZXJ2aWNlX3JlcXVlc3RfYm9va2luZ19mb3JtIiwicmVzdGF1cmFudF93ZWJfbWF4X2RheXNfbWFuYWdlbWVudCIsInNvcGhpc3RpY2F0ZWRfbWVhbF9zdGF0dXNlcyIsImJpbGxpbmdfdXBkYXRlX2Z1bGxfY29udHJhY3QiLCJjdXN0b21lcl9yYW5rIiwiY2hhbmdlX3BsYW4iLCJoaWdobGlnaHRfbGF0ZV9hcnJpdmFscyIsIndhaXRlcl9ib290c3RyYXAiLCJzZXJ2aWNlX21hbmFnZW1lbnQiLCJ0b2dnbGVfbXVsdGlfdXNlciIsIm11bHRpX3VzZXJfbWFuYWdlbWVudCIsIm11bHRpX3VzZXJfcGluX2NvZGVfbWFuYWdlbWVudCIsInFyX2NvZGVfYWRtaW5pc3RyYXRpb24iLCJ3aWRnZXQiLCJzZXR1cF9ndWFjYW1vbGUiLCJzd2l0Y2hfcmVzdGF1cmFudCIsInBvcyIsImVtYWlsX21hbmFnZW1lbnQiLCJyZXN0YXVyYW50X2RlbGF5X21hbmFnZW1lbnQiLCJjYW5jZWxfcmVzZXJ2YXRpb24iLCJhZG1pbmlzdHJhdG9yX21hbmFnZW1lbnQiLCJzZXJ2aWNlX3JlcXVlc3RfYm9va2luZ19mb3JtX21hbmFnZW1lbnQiLCJxcl9jb2RlX21hbmFnZW1lbnQiLCJhdXRvbWF0aWNfY3VzdG9tZXJfcmFua19tYW5hZ2VtZW50IiwiYmlsbGluZyIsIm9mZmVyX21hbmFnZW1lbnQiLCJyZXZpZXdzIiwicHJvbW90aW9uX2RheV9ieV9kYXlfbWFuYWdlbWVudCIsImJvb2thYmxlX3ByZXNldF9tZW51cyIsInNldHVwX2ltcHJpbnQiLCJzZXR1cF9wcmVwYXltZW50IiwicmVzdGF1cmFudF9wcm9maWxlIiwiZG93bmxvYWRfcGhvdG9fbWFuYWdlbWVudCIsInVzZXJfbWFuYWdlbWVudCIsInBvc19tYW5hZ2VtZW50IiwiY3VzdG9tX2N1c3RvbWVyX2Zvcm0iLCJjdXN0b21fY3VzdG9tZXJfZm9ybV9tYW5hZ2VtZW50IiwidGhlZm9ya3BheV9zZXR1cCIsImVkaXRfcmVzdGF1cmFudF9uYW1lIiwiZWRpdF9yZXN0YXVyYW50X3Jlc3RyaWN0ZWRfdGFncyIsImFkbWluX2xmX2hpZGRlbl9maWVsZHMiXSwicmVzdGF1cmFudFV1aWQiOiI5N2NmNWFlZS1lZjQ4LTQ3ODctOTY2MS0zMDU2MmZkNTkzZDEiLCJpYXQiOjE2NjY3NzM4MzIsImV4cCI6MTY2Njg2MDIzMn0.cyJHXiIPalOPcjxsB7mcrNOAMGLnCIPMHO8wkOCMdhY";
  const { getContext, setContext } = operation;
  const context = getContext();

  setContext({
    ...context,
    headers: {
      authorization,
      "restaurant-id": "97cf5aee-ef48-4787-9661-30562fd593d1",
      ...context.headers,
    },
  });

  return forward(operation);
});

const client = new ApolloClient({
  ssrMode: true,
  link: from([authLink, errorLink, httpLink]),
  cache: new InMemoryCache(),
});

export default client;
